2023-10-25 22:55:38,003 INFO Writing results to /scratch/lpoulain/graphcast/graphcast_d_20191128_t_1200_{step}h.grib.
/work/FAC/FGSE/IDYST/tbeucler/default/louis/graphcast_venv/lib/python3.10/site-packages/gribapi/__init__.py:23: UserWarning: ecCodes 2.31.0 or higher is recommended. You are running version 2.30.0
  warnings.warn(
2023-10-25 22:55:38,685 INFO Model description: 
GraphCast model at 0.25deg resolution, with 13 pressure levels. This model is
trained on ERA5 data from 1979 to 2017, and fine-tuned on HRES-fc0 data from
2016 to 2021 and can be causally evaluated on 2022 and later years. This model
does not take `total_precipitation_6hr` as inputs and can make predictions in an
operational setting (i.e., initialised from HRES-fc0).

2023-10-25 22:55:38,686 INFO Model license: 
The model weights are licensed under the Creative Commons
Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0). You
may obtain a copy of the License at:
https://creativecommons.org/licenses/by-nc-sa/4.0/.
The weights were trained on ERA5 data, see README for attribution statement.

2023-10-25 22:55:38,686 INFO Loading params/GraphCast_operational - ERA5-HRES 1979-2021 - resolution 0.25 - pressure levels 13 - mesh 2to6 - precipitation output only.npz: 0.7 second.
2023-10-25 22:55:38,686 INFO Building model: 0.7 second.
2023-10-25 22:55:38,686 INFO Loading surface fields from CDS
2023-10-25 22:55:39,423 INFO Welcome to the CDS
2023-10-25 22:55:39,423 INFO Welcome to the CDS
2023-10-25 22:55:39,423 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-single-levels
2023-10-25 22:55:39,423 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-single-levels
2023-10-25 22:55:39,471 INFO Request is queued
2023-10-25 22:55:39,471 INFO Request is queued
2023-10-25 22:55:40,494 INFO Request is running
2023-10-25 22:55:40,494 INFO Request is running
2023-10-25 22:55:42,019 INFO Request is completed
2023-10-25 22:55:42,019 INFO Request is completed
2023-10-25 22:55:42,019 INFO Downloading https://download-0002-clone.copernicus-climate.eu/cache-compute-0002/cache/data3/adaptor.mars.internal-1698267339.7349231-12749-13-db996195-7ce7-47d0-b23b-788ae181009a.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-1636a940071caa8b0383640439a3f20bfc04f12e5ba3ce1cc67259f31e882c67.cache.tmp (15.8M)
2023-10-25 22:55:42,019 INFO Downloading https://download-0002-clone.copernicus-climate.eu/cache-compute-0002/cache/data3/adaptor.mars.internal-1698267339.7349231-12749-13-db996195-7ce7-47d0-b23b-788ae181009a.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-1636a940071caa8b0383640439a3f20bfc04f12e5ba3ce1cc67259f31e882c67.cache.tmp (15.8M)
  0%|          | 0.00/15.8M [00:00<?, ?B/s]  8%|▊         | 1.23M/15.8M [00:00<00:01, 12.5MB/s] 52%|█████▏    | 8.24M/15.8M [00:00<00:00, 48.0MB/s] 97%|█████████▋| 15.4M/15.8M [00:00<00:00, 60.1MB/s]                                                    2023-10-25 22:55:42,429 INFO Download rate 38.6M/s
2023-10-25 22:55:42,429 INFO Download rate 38.6M/s
2023-10-25 22:55:42,500 INFO Welcome to the CDS
2023-10-25 22:55:42,500 INFO Welcome to the CDS
2023-10-25 22:55:42,501 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-single-levels
2023-10-25 22:55:42,501 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-single-levels
2023-10-25 22:55:42,701 INFO Request is queued
2023-10-25 22:55:42,701 INFO Request is queued
2023-10-25 22:55:43,726 INFO Request is running
2023-10-25 22:55:43,726 INFO Request is running
2023-10-25 22:55:45,250 INFO Request is completed
2023-10-25 22:55:45,250 INFO Request is completed
2023-10-25 22:55:45,250 INFO Downloading https://download-0007-clone.copernicus-climate.eu/cache-compute-0007/cache/data2/adaptor.mars.internal-1698267342.9037304-15274-4-eaf1476c-2757-4707-9bec-cd0c0d8782bd.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-d062df1bb0818771cfdadf5bc2d20f674326ea9787f822c04e4cd7f9c97a0579.cache.tmp (15.8M)
2023-10-25 22:55:45,250 INFO Downloading https://download-0007-clone.copernicus-climate.eu/cache-compute-0007/cache/data2/adaptor.mars.internal-1698267342.9037304-15274-4-eaf1476c-2757-4707-9bec-cd0c0d8782bd.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-d062df1bb0818771cfdadf5bc2d20f674326ea9787f822c04e4cd7f9c97a0579.cache.tmp (15.8M)
  0%|          | 0.00/15.8M [00:00<?, ?B/s]  2%|▏         | 292k/15.8M [00:00<00:06, 2.69MB/s] 10%|█         | 1.64M/15.8M [00:00<00:01, 8.93MB/s] 17%|█▋        | 2.75M/15.8M [00:00<00:01, 9.92MB/s] 25%|██▍       | 3.88M/15.8M [00:00<00:01, 10.5MB/s] 32%|███▏      | 5.05M/15.8M [00:00<00:01, 10.9MB/s] 39%|███▉      | 6.18M/15.8M [00:00<00:00, 11.0MB/s] 46%|████▌     | 7.23M/15.8M [00:00<00:00, 10.1MB/s] 52%|█████▏    | 8.21M/15.8M [00:00<00:00, 9.90MB/s] 58%|█████▊    | 9.16M/15.8M [00:00<00:00, 9.44MB/s] 64%|██████▎   | 10.1M/15.8M [00:01<00:00, 9.37MB/s] 69%|██████▉   | 11.0M/15.8M [00:01<00:00, 9.46MB/s] 75%|███████▌  | 11.9M/15.8M [00:01<00:00, 9.13MB/s] 82%|████████▏ | 12.9M/15.8M [00:01<00:00, 9.35MB/s] 88%|████████▊ | 14.0M/15.8M [00:01<00:00, 9.57MB/s] 95%|█████████▍| 15.0M/15.8M [00:01<00:00, 9.67MB/s]                                                    2023-10-25 22:55:47,049 INFO Download rate 8.8M/s
2023-10-25 22:55:47,049 INFO Download rate 8.8M/s
2023-10-25 22:55:47,079 INFO Loading pressure fields from CDS
2023-10-25 22:55:47,100 INFO Welcome to the CDS
2023-10-25 22:55:47,100 INFO Welcome to the CDS
2023-10-25 22:55:47,101 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-pressure-levels
2023-10-25 22:55:47,101 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-pressure-levels
2023-10-25 22:55:47,151 INFO Request is queued
2023-10-25 22:55:47,151 INFO Request is queued
2023-10-25 22:55:48,174 INFO Request is running
2023-10-25 22:55:48,174 INFO Request is running
2023-10-25 22:55:55,374 INFO Request is completed
2023-10-25 22:55:55,374 INFO Request is completed
2023-10-25 22:55:55,374 INFO Downloading https://download-0006-clone.copernicus-climate.eu/cache-compute-0006/cache/data4/adaptor.mars.internal-1698267347.4395459-9249-20-4f39c6fa-5dce-456b-a822-73f8daf08142.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-8f58af2471e07e16e34ad7a8561865fdb52fefefd16023062776246b1c2cd943.cache.tmp (154.5M)
2023-10-25 22:55:55,374 INFO Downloading https://download-0006-clone.copernicus-climate.eu/cache-compute-0006/cache/data4/adaptor.mars.internal-1698267347.4395459-9249-20-4f39c6fa-5dce-456b-a822-73f8daf08142.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-8f58af2471e07e16e34ad7a8561865fdb52fefefd16023062776246b1c2cd943.cache.tmp (154.5M)
  0%|          | 0.00/154M [00:00<?, ?B/s]  2%|▏         | 2.69M/154M [00:00<00:05, 28.2MB/s]  6%|▌         | 9.52M/154M [00:00<00:02, 53.8MB/s] 11%|█         | 16.7M/154M [00:00<00:02, 63.4MB/s] 15%|█▌        | 23.8M/154M [00:00<00:02, 68.0MB/s] 20%|██        | 31.0M/154M [00:00<00:01, 70.7MB/s] 25%|██▍       | 38.2M/154M [00:00<00:01, 72.3MB/s] 29%|██▉       | 45.5M/154M [00:00<00:01, 73.5MB/s] 34%|███▍      | 52.5M/154M [00:00<00:01, 68.1MB/s] 38%|███▊      | 59.0M/154M [00:01<00:02, 47.3MB/s] 42%|████▏     | 64.4M/154M [00:01<00:02, 39.5MB/s] 45%|████▍     | 68.8M/154M [00:01<00:02, 35.9MB/s] 47%|████▋     | 72.8M/154M [00:01<00:02, 33.6MB/s] 49%|████▉     | 76.3M/154M [00:01<00:02, 32.1MB/s] 51%|█████▏    | 79.5M/154M [00:01<00:02, 30.0MB/s] 53%|█████▎    | 82.5M/154M [00:02<00:02, 26.9MB/s] 55%|█████▌    | 85.2M/154M [00:02<00:03, 23.3MB/s] 57%|█████▋    | 87.5M/154M [00:02<00:03, 20.3MB/s] 58%|█████▊    | 89.5M/154M [00:02<00:03, 17.3MB/s] 59%|█████▉    | 91.3M/154M [00:02<00:04, 16.2MB/s] 60%|██████    | 92.9M/154M [00:02<00:04, 14.1MB/s] 61%|██████    | 94.2M/154M [00:03<00:04, 13.0MB/s] 62%|██████▏   | 95.5M/154M [00:03<00:04, 12.6MB/s] 63%|██████▎   | 96.7M/154M [00:03<00:04, 12.1MB/s] 63%|██████▎   | 97.9M/154M [00:03<00:04, 12.0MB/s] 64%|██████▍   | 99.0M/154M [00:03<00:04, 11.9MB/s] 65%|██████▍   | 100M/154M [00:03<00:04, 12.2MB/s]  66%|██████▌   | 102M/154M [00:03<00:04, 12.5MB/s] 67%|██████▋   | 103M/154M [00:03<00:04, 12.9MB/s] 68%|██████▊   | 104M/154M [00:03<00:03, 13.2MB/s] 69%|██████▊   | 106M/154M [00:03<00:03, 13.4MB/s] 69%|██████▉   | 107M/154M [00:04<00:03, 13.8MB/s] 71%|███████   | 109M/154M [00:04<00:03, 14.5MB/s] 72%|███████▏  | 111M/154M [00:04<00:03, 15.3MB/s] 73%|███████▎  | 112M/154M [00:04<00:02, 15.6MB/s] 74%|███████▎  | 114M/154M [00:04<00:02, 15.9MB/s] 75%|███████▍  | 115M/154M [00:04<00:02, 16.1MB/s] 76%|███████▌  | 117M/154M [00:04<00:02, 16.4MB/s] 77%|███████▋  | 119M/154M [00:04<00:02, 17.3MB/s] 78%|███████▊  | 121M/154M [00:04<00:01, 18.0MB/s] 80%|███████▉  | 123M/154M [00:05<00:01, 18.4MB/s] 81%|████████  | 125M/154M [00:05<00:01, 18.7MB/s] 82%|████████▏ | 127M/154M [00:05<00:01, 19.5MB/s] 84%|████████▎ | 129M/154M [00:05<00:01, 20.3MB/s] 85%|████████▍ | 131M/154M [00:05<00:01, 19.3MB/s] 86%|████████▌ | 133M/154M [00:05<00:01, 18.4MB/s] 87%|████████▋ | 135M/154M [00:05<00:01, 18.0MB/s] 88%|████████▊ | 137M/154M [00:05<00:01, 17.3MB/s] 89%|████████▉ | 138M/154M [00:05<00:00, 17.1MB/s] 91%|█████████ | 140M/154M [00:06<00:00, 17.0MB/s] 92%|█████████▏| 142M/154M [00:06<00:00, 17.2MB/s] 93%|█████████▎| 144M/154M [00:06<00:00, 17.8MB/s] 94%|█████████▍| 145M/154M [00:06<00:00, 18.0MB/s] 95%|█████████▌| 147M/154M [00:06<00:00, 16.6MB/s] 96%|█████████▋| 149M/154M [00:06<00:00, 15.9MB/s] 97%|█████████▋| 150M/154M [00:06<00:00, 15.3MB/s] 98%|█████████▊| 152M/154M [00:06<00:00, 15.4MB/s] 99%|█████████▉| 154M/154M [00:06<00:00, 15.7MB/s]                                                  2023-10-25 22:56:02,420 INFO Download rate 21.9M/s
2023-10-25 22:56:02,420 INFO Download rate 21.9M/s
2023-10-25 22:56:02,476 INFO Welcome to the CDS
2023-10-25 22:56:02,476 INFO Welcome to the CDS
2023-10-25 22:56:02,476 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-pressure-levels
2023-10-25 22:56:02,476 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/reanalysis-era5-pressure-levels
2023-10-25 22:56:02,503 INFO Request is queued
2023-10-25 22:56:02,503 INFO Request is queued
2023-10-25 22:56:03,527 INFO Request is running
2023-10-25 22:56:03,527 INFO Request is running
2023-10-25 22:56:10,727 INFO Request is completed
2023-10-25 22:56:10,727 INFO Request is completed
2023-10-25 22:56:10,727 INFO Downloading https://download-0021.copernicus-climate.eu/cache-compute-0021/cache/data2/adaptor.mars.internal-1698267363.2969766-4116-13-f0e48579-8b73-4f21-81ca-0da0a3fc34a4.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-04a9063ebcdfb363fdbf90e5d9c0f3528bf91ac19225ab443bcb39af2f0d0604.cache.tmp (154.5M)
2023-10-25 22:56:10,727 INFO Downloading https://download-0021.copernicus-climate.eu/cache-compute-0021/cache/data2/adaptor.mars.internal-1698267363.2969766-4116-13-f0e48579-8b73-4f21-81ca-0da0a3fc34a4.grib to /tmp/34662430/climetlab-lpoulain/cds-retriever-04a9063ebcdfb363fdbf90e5d9c0f3528bf91ac19225ab443bcb39af2f0d0604.cache.tmp (154.5M)
  0%|          | 0.00/154M [00:00<?, ?B/s]  2%|▏         | 2.73M/154M [00:00<00:05, 28.6MB/s]  6%|▋         | 9.68M/154M [00:00<00:02, 54.6MB/s] 10%|▉         | 14.9M/154M [00:00<00:03, 41.2MB/s] 14%|█▍        | 21.9M/154M [00:00<00:02, 51.9MB/s] 19%|█▉        | 29.0M/154M [00:00<00:02, 59.0MB/s] 23%|██▎       | 36.1M/154M [00:00<00:01, 63.8MB/s] 28%|██▊       | 43.1M/154M [00:00<00:01, 67.0MB/s] 33%|███▎      | 50.2M/154M [00:00<00:01, 69.2MB/s] 37%|███▋      | 56.9M/154M [00:00<00:01, 65.4MB/s] 41%|████      | 63.3M/154M [00:01<00:01, 54.8MB/s] 45%|████▍     | 68.9M/154M [00:01<00:01, 49.1MB/s] 48%|████▊     | 73.8M/154M [00:01<00:01, 45.7MB/s] 51%|█████     | 78.4M/154M [00:01<00:01, 40.1MB/s] 53%|█████▎    | 82.4M/154M [00:01<00:02, 36.3MB/s] 56%|█████▌    | 86.1M/154M [00:01<00:02, 34.1MB/s] 58%|█████▊    | 89.4M/154M [00:02<00:02, 32.2MB/s] 60%|█████▉    | 92.5M/154M [00:02<00:02, 31.2MB/s] 62%|██████▏   | 95.7M/154M [00:02<00:01, 31.4MB/s] 64%|██████▍   | 99.0M/154M [00:02<00:01, 32.0MB/s] 66%|██████▌   | 102M/154M [00:02<00:01, 32.7MB/s]  68%|██████▊   | 105M/154M [00:02<00:01, 32.5MB/s] 70%|███████   | 109M/154M [00:02<00:01, 32.7MB/s] 72%|███████▏  | 112M/154M [00:02<00:01, 33.3MB/s] 75%|███████▍  | 115M/154M [00:02<00:01, 32.9MB/s] 77%|███████▋  | 118M/154M [00:02<00:01, 32.9MB/s] 79%|███████▊  | 122M/154M [00:03<00:01, 33.1MB/s] 81%|████████  | 125M/154M [00:03<00:00, 33.1MB/s] 83%|████████▎ | 128M/154M [00:03<00:00, 34.0MB/s] 85%|████████▌ | 132M/154M [00:03<00:00, 35.2MB/s] 88%|████████▊ | 136M/154M [00:03<00:00, 36.3MB/s] 90%|█████████ | 139M/154M [00:03<00:00, 37.2MB/s] 93%|█████████▎| 143M/154M [00:03<00:00, 37.5MB/s] 95%|█████████▍| 147M/154M [00:03<00:00, 37.9MB/s] 97%|█████████▋| 150M/154M [00:03<00:00, 37.6MB/s]100%|█████████▉| 154M/154M [00:03<00:00, 38.5MB/s]                                                  2023-10-25 22:56:14,793 INFO Download rate 38M/s
2023-10-25 22:56:14,793 INFO Download rate 38M/s
2023-10-25 22:56:19,610 INFO Creating forcing variables: 4 seconds.
2023-10-25 22:56:22,391 INFO Converting GRIB to xarray: 2 seconds.
2023-10-25 22:56:22,612 INFO Reindexing: 0.2 second.
2023-10-25 22:56:22,627 INFO Creating training data: 43 seconds.
2023-10-25 22:56:22,959 INFO Extracting input targets: 0.3 second.
2023-10-25 22:56:22,959 INFO Creating input data (total): 44 seconds.
2023-10-25 22:56:23,276 INFO Unable to initialize backend 'rocm': NOT_FOUND: Could not find registered platform with name: "rocm". Available platform names are: CUDA Interpreter Host
2023-10-25 22:56:23,276 INFO Unable to initialize backend 'tpu': module 'jaxlib.xla_extension' has no attribute 'get_tpu_client'
2023-10-25 22:56:23,276 INFO Unable to initialize backend 'plugin': xla_extension has no attributes named get_plugin_device_client. Compile TensorFlow with //tensorflow/compiler/xla/python:enable_plugin_device set to true (defaults to false) to enable this.
2023-10-25 22:57:43.156901: E external/xla/xla/service/slow_operation_alarm.cc:65] Constant folding an instruction is taking > 1s:

  %pad.149 = bf16[3114720,8]{1,0} pad(bf16[3114720,4]{1,0} %constant.365, bf16[] %constant.768), padding=0_0x0_4, metadata={op_name="jit(<unnamed wrapped function>)/jit(main)/while/body/remat/mesh2grid_gnn/_embed/mesh2grid_gnn/sequential/encoder_edges_mesh2grid_mlp/linear_0/dot_general[dimension_numbers=(((2,), (0,)), ((), ())) precision=None preferred_element_type=None]" source_file="/work/FAC/FGSE/IDYST/tbeucler/default/louis/graphcast_venv/lib/python3.10/site-packages/haiku/_src/basic.py" source_line=180}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2023-10-25 22:57:52.336985: E external/xla/xla/service/slow_operation_alarm.cc:133] The operation took 10.180169569s
Constant folding an instruction is taking > 1s:

  %pad.149 = bf16[3114720,8]{1,0} pad(bf16[3114720,4]{1,0} %constant.365, bf16[] %constant.768), padding=0_0x0_4, metadata={op_name="jit(<unnamed wrapped function>)/jit(main)/while/body/remat/mesh2grid_gnn/_embed/mesh2grid_gnn/sequential/encoder_edges_mesh2grid_mlp/linear_0/dot_general[dimension_numbers=(((2,), (0,)), ((), ())) precision=None preferred_element_type=None]" source_file="/work/FAC/FGSE/IDYST/tbeucler/default/louis/graphcast_venv/lib/python3.10/site-packages/haiku/_src/basic.py" source_line=180}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2023-10-25 22:57:54.750156: E external/xla/xla/service/slow_operation_alarm.cc:65] Constant folding an instruction is taking > 2s:

  %pad.1 = bf16[1618752,8]{1,0} pad(bf16[1618745,4]{1,0} %constant.374, bf16[] %constant.687), padding=0_7x0_4, metadata={op_name="jit(<unnamed wrapped function>)/jit(main)/while/body/remat/grid2mesh_gnn/_embed/grid2mesh_gnn/sequential/encoder_edges_grid2mesh_mlp/linear_0/dot_general[dimension_numbers=(((2,), (0,)), ((), ())) precision=None preferred_element_type=None]" source_file="/work/FAC/FGSE/IDYST/tbeucler/default/louis/graphcast_venv/lib/python3.10/site-packages/haiku/_src/basic.py" source_line=180}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2023-10-25 22:57:58.176647: E external/xla/xla/service/slow_operation_alarm.cc:133] The operation took 5.426550649s
Constant folding an instruction is taking > 2s:

  %pad.1 = bf16[1618752,8]{1,0} pad(bf16[1618745,4]{1,0} %constant.374, bf16[] %constant.687), padding=0_7x0_4, metadata={op_name="jit(<unnamed wrapped function>)/jit(main)/while/body/remat/grid2mesh_gnn/_embed/grid2mesh_gnn/sequential/encoder_edges_grid2mesh_mlp/linear_0/dot_general[dimension_numbers=(((2,), (0,)), ((), ())) precision=None preferred_element_type=None]" source_file="/work/FAC/FGSE/IDYST/tbeucler/default/louis/graphcast_venv/lib/python3.10/site-packages/haiku/_src/basic.py" source_line=180}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2023-10-25 22:58:10,404 INFO Doing full rollout prediction in JAX: 1 minute 47 seconds.
2023-10-25 22:58:10,405 INFO Converting output xarray to GRIB and saving
2023-10-25 22:58:19,389 INFO Saving output data: 8 seconds.
2023-10-25 22:58:19,394 INFO Total time: 2 minutes 42 seconds.
